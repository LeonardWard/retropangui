#!/usr/bin/env bash

# =======================================================
# Retro Pangui Platform Configuration - Generic ARM64
# 파일명: platforms/aarch64.conf
# 설명: 알 수 없는 ARM64 (aarch64) 기기용 안전한 기본 설정
#
# ⚠️  주의: 이 파일은 fallback 용도입니다.
#    최적의 성능을 위해서는 기기별 설정 파일을 만드세요!
#
# 사용 용도:
# 1. 미지원 ARM64 기기에서 강제 진행 시 기본값
# 2. 새 플랫폼 추가 시 복사할 템플릿
# =======================================================

# --- RetroArch 버전 설정 ---
RA_VERSION=""
RA_BRANCH="master"

# --- 활성화 코어 목록 ---
# 보수적으로 기본 코어만 (성능 미확인)
PLATFORM_ENABLED_CORES=(
    "${COMMON_ENABLED_CORES[@]}"
    "lr-pcsx-rearmed"       # PlayStation 1 (ARM 최적화)
)

# --- 비활성화 코어 목록 ---
# 성능 요구사항 높은 코어 비활성화
PLATFORM_DISABLED_CORES=(
    "lr-dolphin"
    "lr-citra"
    "lr-ppsspp"
    "lr-mupen64plus-next"
    "lr-flycast"
)

# --- 빌드 옵션 ---
# Generic ARMv8-A (모든 ARM64 호환)
PLATFORM_CFLAGS="-march=armv8-a -mtune=generic"
PLATFORM_LDFLAGS=""
PLATFORM_MAKEFLAGS="-j$(nproc)"

# --- GPU 백엔드 설정 ---
# 가장 안전한 설정 (대부분의 ARM GPU 지원)
USE_OPENGL="no"         # ARM은 데스크탑 GL 미지원
USE_GLES="yes"          # OpenGL ES (거의 모든 ARM GPU 지원)
USE_VULKAN="no"         # Vulkan은 기기별로 다름
USE_KMS="yes"           # KMS/DRM은 일반적으로 지원
USE_WAYLAND="no"
USE_X11="no"

# --- 최적화 레벨 ---
OPT_LEVEL="-O2"         # 안정성 우선

# --- RetroArch configure 옵션 ---
RA_CONFIGURE_OPTS=(
    "--prefix=$INSTALL_ROOT_DIR"
    "--disable-x11"
    "--disable-wayland"
    "--disable-opengl"
    "--enable-opengles"     # OpenGL ES 2.0/3.0
    "--enable-kms"          # KMS/DRM
    "--enable-egl"
    "--enable-udev"
    "--enable-alsa"
    "--enable-threads"
    "--enable-ffmpeg"
    "--enable-7zip"
    "--enable-sdl2"
    "--enable-neon"         # ARM NEON SIMD
)

# --- 추가 환경 변수 ---
export CFLAGS="$PLATFORM_CFLAGS $OPT_LEVEL"
export CXXFLAGS="$PLATFORM_CFLAGS $OPT_LEVEL"
